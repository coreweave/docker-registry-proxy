---
# This file was originally generated by a template in:
# https://github.com/coreweave/k8s-infrastructure-ansible/blob/master/roles/administrative_tasks/templates/new_zone/values-base-mgmt.yaml.j2
clusterSpec:
  networkAllocations:
    externalLbCIDRs:
      cw-mgmt: 10.80.250.0/23
      dpu: 10.191.63.0/24  # Site specific CIDR for DPU LB
      public: 166.19.35.0/26
  apiserver:
    addtlUrl: api-cw-mgmt.coreweave-mgmt.k8s.us-west-04a.int.coreweave.com
applications:
  box-office:
    namespace: box-office
    valuesMerge:
      box-office:
        registerWithParent: true
      ingress:
        ingressClassName: "traefik-internal"
  control-plane:
    valuesMerge:
      etcd-events:
        replicaCount: 5
      etcd-local:
        replicaCount: 5
      kubeception:
        apiserver:
          service:
            addtlLocalService:
              loadBalancerIP: 10.80.248.11
      pki:
        apiServer:
          ipSans:
          - 127.0.0.1
          - 10.80.248.11
          - 172.27.80.11
          - 172.24.0.1
          - 172.26.64.10
          - 172.26.64.238
  cw-node-controller:
    valuesMerge:
      controllerConfig:
        topologyLabelsEnabled: true
      nodeLifeCycle:
        applyTaints: false
  fleet-lifecycle-controller:
    valuesMerge:
      flcc:
        defaultNodeProfile: "be1096-fleetops-us-west-04a-default"
        nodeEviction:
          enabled: true
  in-cluster-config:
    valuesMerge:
      clusterInfo:
        certificateAuthorityData: "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURjRENDQWxpZ0F3SUJBZ0lSQUlsM0JDbW14eFNjVWJSRFRybnVzb3d3RFFZSktvWklodmNOQVFFTEJRQXcKUWpFU01CQUdBMVVFQ2hNSlEyOXlaVmRsWVhabE1SY3dGUVlEVlFRTEV3NUpibVp5WVhOMGNuVmpkSFZ5WlRFVApNQkVHQTFVRUF4TUtTM1ZpWlhKdVpYUmxjekFlRncweU5ERXhNVFF5TWpNME1UVmFGdzB6TkRBNU1qTXlNak0wCk1UVmFNRUl4RWpBUUJnTlZCQW9UQ1VOdmNtVlhaV0YyWlRFWE1CVUdBMVVFQ3hNT1NXNW1jbUZ6ZEhKMVkzUjEKY21VeEV6QVJCZ05WQkFNVENrdDFZbVZ5Ym1WMFpYTXdnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBdwpnZ0VLQW9JQkFRQ3lpSzM4dThoODFLVnZQRmRtdmQzU0l0R0JqUk1wcHJiSTFKY1JKVC9GK1lOUG50bmxwWXd1CnlnS0ZjY1liU2Y5ejBYZlYxcmNNRGZSWWwvTlVsOS93by9KUjNmWHJiMVBxNWMxZVB0SDhyRTE0M1d3RFJnc0IKRmEvQ3R6V2EzWVdqZVE2OHZTYnhUbHoyNWZYb0VHdVRCdXpzRzJsUTRLckswUXNQa0RHb0o2SXRLa2FQUkhWbQpqL0JacndxL3RoQ1QxMWw2d05GVWw5ejBQNE0wWis5dmJjMnFhU1ZPKzB5bTZXOExMTXMyRTRBZVVhMFZmS281CmpOaGtGSVZ3VkpXeWlLY1FtUmtmc3B6MFdtc0Q0bnc0NlcydWVYaks1MWlFeDhGOHpjVjk5NHdIZlhrNC94a04KVlhZZlc0ZVRSYW9haDVPaXRncmNvQ2ZVL2ZmaEhCTk5BZ01CQUFHallUQmZNQTRHQTFVZER3RUIvd1FFQXdJQwpwREFkQmdOVkhTVUVGakFVQmdnckJnRUZCUWNEQVFZSUt3WUJCUVVIQXdJd0R3WURWUjBUQVFIL0JBVXdBd0VCCi96QWRCZ05WSFE0RUZnUVU3KytxckpUVU1aTm5BcXk5Z00vWHBaaUdEdzR3RFFZSktvWklodmNOQVFFTEJRQUQKZ2dFQkFFeU1KREhDRWo3MU5qRlA2aDVhTTBJMWlnSk9NTXVsSGUrdGZjVCtYNGFHcUUzWjVLdGhaaEpIbDBXdQp5M01UL25mRGVDVVhIQkRNYlc2ZE9hUkFGN04zNzlzTU5mL2xxVWlydDhhRDVEUTdZeFo5OHhsTEhmWWs5S3VECjJBNDByZ0FTeU5ibWs2VEhkZE4vV1BXbWlqdk9XUlJoOUVYQlBEWUQ5bDlURGtVVUZrK2VYekFBT1RBdk81Y1YKWWtRR2Y5bEZXSU5SVzZ0TUorazFDY2wyOGxQYjdYVWtRanhHV3lLdXZvdXBidGpIMXk5a1lQRXY4MEx6N0haVQp6a2g0QXJnTUkzbjY2YUxIbUUzcEUxeXQrN1hER2lwZ0EvSTRaai85OHZTMmIzblp6YkpUVS9kdG5XV05pK3F4Cm94ZmtFdTBra3R5V1I4clo5OVkwYW5RRzhaQT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo="
      kubeletConfigOverrides:
        maxPods: 256
  nimbus-core-crs:
    enabled: true
  nimbus-bmn-controller:
    enabled: true
    valuesMerge:
      dryRun: false
  teleport-rbac:
    valuesMerge:
      coreweave:
        saml:
          entityDescriptorUrl: https://login.coreweave.com/app/exklanc3sqgM1MILl5d7/sso/saml/metadata # TODO: Teleport setup
      miscManifests:
      - apiVersion: resources.teleport.dev/v2
        kind: TeleportProvisionToken
        metadata:
          name: slurm-aef4b2-whale
        spec:
          roles: [node]
          join_method: kubernetes
          kubernetes:
            type: static_jwks
            static_jwks:
              jwks: |
                {"keys":[{"use":"sig","kty":"RSA","kid":"P_1GUNKEB-qJTSafoZ6HLCJliSMP-Ye-INeVWI6KS2M","alg":"RS256","n":"whWLkpW4jl14m5CUNSh2tBqhvvWeizuyVf3yrZb68S4jvfFZhHXNbKePN1g8QWrxaw9dJnSOKA_j-vwpjJc1LK3iUdeHclS-wXu_0Ggd3LVO7V-UXej65YjcKKAAtlvZ0PtD95R_KIzDMhCOfgo0wTBWLx6nAGP1GRPGjQFUOmCNreQbwaFezQdx9HJOzWjQiPoAdJcPPZfhcuElEUZRmTBQFtC088IGdNnlxkdUpc8MO-bxqUXtUqMh_MsyFYUespq9TwGV8VOmFZild2b5ck-Mgwlf1tqTrSIi-yxJVU5XiVSK70IMJbkI02mAVIWZS0nxxrJ4NTf9ma6dIQPfcOrYxPtW0ut-YHebUAiqsPmxNJ4arfUHgoTmRimNxqzHnM0ha4WE5R9Ee18oW9mzyvInpOFv65V19yh2SvtSi7BefrlAlPoFTlLh4DJXlvZDxMM0SYuAx3QdvArPwzsuMq13od8D2OCJOhZzSfWtqAYqV_p9DVWh3V57ON_1WjmQXbDkSR4UwxSf--rx-IZxUki8Aa5sTdEUZu2_bIPyNNoFhkRyfoP_cYUpnsd5dihG6asN8z3QQt3vHQ5FBDYmVTAo2ApOdb9mXioydEUiS9YEOAq-8cUkDdEjvdmBXHaWXn6keQnVKTLnNNyhf57E1e8n2dApcTERXce8XWR_hE8","e":"AQAB"}]}
            allow:
            - service_account: "tenant-slurm:slurm-tl-login-sa"
  teleport:
    valuesMerge:
      coreweave:
        awxTbot:
          enabled: true
  rook-ceph: # TODO: enable once ceph is available
    enabled: false
  rook-operator:
    enabled: false
  vast-grpc:
    enabled: true
    valueFiles:
      - values-us-west-04a-mgmt.yaml
  vast-csi-controller:
    valuesMerge:
      serviceMonitor:
        enabled: true
  tailscale-operator:
    enabled: false
  metrics:
    valuesMerge:
      portkey:
        monitor:
          enabled: true
          endpoints:
          - ip:
            - 10.191.1.241
            - 10.191.1.242
            - 10.191.1.243
            - 10.191.1.244
            name: US-WEST-04A
            honorTimestamps: false
      ufm:
        monitor:
          enabled: true
          endpoints:
            - ip:
                - 10.191.0.23
                - 10.191.0.44
              name: US-WEST-04A-FAB19
              ports:
                - name: ufm
                  port: 8080
                - name: node-exporter
                  port: 9100
                - name: lowfreq
                  port: 9002
              paths:
                - path: /temperature
                  port: ufm
                  interval: 300s
                  honorTimestamps: false
                - path: /metrics
                  port: node-exporter
                - path: /low_freq
                  port: lowfreq
                  interval: 300s
              pathGroups:
                - paths:
                  - /cw1
                  - /cw2
                  - /fabric_verification
                  port: ufm
                  honorTimestamps: false
  node-assigner:
    enabled: true
    valuesMerge:
      instanceTypes:
        cd-gp-i64-erapids:
          enabled: true
        cd-gp-a192-genoa:
          enabled: true
        gd-8xh100ib-i128:
          enabled: true
        gd-8xh200ib-i128:
          enabled: true
  ufm-proxy:
    enabled: true
    valuesMerge:
      config:
        fabrics:
          - name: fab19
            ufms:
              - address: 10.191.0.23
                port: 443
              - address: 10.191.0.44
                port: 443
  ib-partition-controller:
    enabled: true
    valuesMerge:
      config:
        partitionLabelSelector: ds.coreweave.com/physical-topology.region=US-WEST-04
        ufmHost: ufm-proxy-fab19.hpcnet.svc.cluster.local
      coreweave:
        externalSecrets:
          ufm-token:
            secretStoreName: hpcnet
            data:
              - remoteRef:
                  key: PARTITION_CONTROLLER_FAB19_UFM_TOKEN
                secretKey: UFM_TOKEN
  ib-bmn-controller:
    enabled: true
    valuesMerge:
      config:
        partitionLabelSelector: ds.coreweave.com/physical-topology.region=US-WEST-04
        ufmHost: ufm-proxy-fab19.hpcnet.svc.cluster.local
      coreweave:
        externalSecrets:
          ib-bmn-controller-ufm-token:
            secretStoreName: hpcnet
            data:
              - remoteRef:
                  key: BMN_CONTROLLER_FAB19_UFM_TOKEN
                secretKey: UFM_TOKEN
  pvmo:
    valuesMerge:
      monitoring:
        enabled: true
        serviceAccount:
          name: vmagent-us-west-04-coreweave-us-west-04a-internal
          namespace: victoria-metrics
  npo:
    enabled: false
  npo-cfg:
    enabled: false
